# React Suprya app example

This is an example barebones app built with Suprya. Here's an explanation on everything:

## `package.json`

### `npm run` scripts

We use [`webpack-serve`](https://github.com/webpack-contrib/webpack-serve) to serve our app in development (while also statically serving the `public` directory). Suprya takes care of adding the [`historyApiFallback`](https://github.com/webpack-contrib/webpack-serve#add-on-features) addon to always serve the `index.html` produced by [`html-webpack-plugin`](https://github.com/jantimon/html-webpack-plugin) when a static file isn't found in the `public` directory or webpack hasn't bundled a module with that name. This makes it possible for router libraries (in this case we're using the [Reach Router](https://reach.tech/router) lib) to use the [History API](https://developer.mozilla.org/en-US/docs/Web/API/History) and change the route without breaking hot reloading.

To build the app for production we use [`webpack-command`](https://github.com/webpack-contrib/webpack-command) with the `--run-prod` flag which sets the mode to `production`, enables the `UglifyJS` plugin and defines `NODE_ENV` to `"production"` using the [DefinePlugin](https://webpack.js.org/plugins/define-plugin/).

Notice the use of `cross-env` to set `NODE_ENV` to `production`, which allows the usage of POSIX env variables definitions on Windows. You can read more about it on [this gist](https://gist.github.com/hugmanrique/8e71844cf20f5f49ff856137b723a7ae).

### browserslist

The `browserslist` array tells the [`@babel/preset-env`](https://new.babeljs.io/docs/en/next/babel-preset-env.html) which browsers our app targets using [Browserslist queries](https://github.com/browserslist/browserslist#queries).

## `webpack.config.js`

As you can see, Suprya eliminates most of the boilerplate config values for you while giving you absolute flexibility on what loaders or plugins you want to load, as well as more [advanced options](https://webpack.js.org/configuration/) such as sourcemaps, chunk splitting and more.

There are some special properties:

- The `routes` array tells Suprya which routes you want to prerender using the [prerender-loader](https://github.com/GoogleChromeLabs/prerender-loader) library. Each route requires the `url` property (which will be accesible on the `prerender.js` file on `window.location` and similar APIs), an optional title and other [`html-webpack-plugin` options](https://github.com/jantimon/html-webpack-plugin#options) such as `meta` (which we used to set the description of the Home page).
- `defaultTitle` will be used as a fallback in case a route doesn't have a `title` key. It will get injected on your `template.html` file under the `<head>` element with an standard `<title>` tag.
- `mode` tells webpack and Suprya to use their built-in optimizations accordingly. Webpack enables [these options](https://webpack.js.org/concepts/mode/) while Suprya adds [these](../../README.md#opinionated-webpack-options) (which are all overrideable).

You can then use any [standard Webpack config options](https://webpack.js.org/configuration/) such as `module.rules`, `optimization` or `plugins`.

## `src/index.js`

This is the standard entry file which will get referenced on each HTML prerendered page. In this case we just render the `App` component.

## `src/template.html`

This is the file which will be the base of all the prerendered outputs and the development mode template. We've used a [Handlebars](https://handlebarsjs.com/) expression that tells Suprya that the prerendered content (generated by the `src/prerender.js` file) needs to be appended under `#root`.

## `src/prerender.js`

This file will get run under a [JSDOM](https://github.com/jsdom/jsdom) instance which supports most of the DOM and HTML standards thanks to [prerender-loader](https://github.com/GoogleChromeLabs/prerender-loader/). This file should look familiar to a server-side rendering engine, as we use the [`ReactDOMServer.renderToString`](https://reactjs.org/docs/react-dom-server.html#rendertostring) API which returns an HTML string which we export. You can read about exporting Promises or async functions (which gives you more flexibility) on the [README](../../README.md) file.

## `src/components/App.js`

This is our main App component which renders a [Reach Router](https://reach.tech/router) with two routes (the `Home` and the `Contact` components). Please note that the `path` prop of these children must match the same one specified on the `webpack.config.js` or the contents will not get rendered.

Dynamic routes are not supported, but you can still use them as long as your server always fallbacks to the `index.html`, which will perform a render from zero instead of hydrating the `App` component.